---
title: "Comparison of DTU"
author: "Christoph Kiefer"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
    html_document:
        toc: true
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE)
```

```{r library, include=FALSE}
source(".Rprofile")
library("dplyr")
library("readr")
library("purrr")
library("UpSetR")
```

```{r dataImport}
df <- read_rds(snakemake@input[["all"]])
```

# Upset plots

## All datasets

```{r}
df %>%
    mutate_if(is.numeric, function(x) as.integer(x < .05)) %>%
    as.data.frame() %>%
    tibble::column_to_rownames("ensembl_gene_id_version") %>%
    upset(nsets = 8,
        nintersects = 204,
        order.by = "freq")
```

## Without illumina

```{r}
df %>%
    select_at(vars(-matches("illumina"))) %>%
    mutate_if(is.numeric, function(x) as.integer(x < .05)) %>%
    as.data.frame() %>%
    tibble::column_to_rownames("ensembl_gene_id_version") %>%
    upset(nsets = 6,
        nintersects = 204,
        order.by = "freq")
```

## Dexseq only

```{r}
df %>%
    select_at(vars(-matches("drimseq"))) %>%
    mutate_if(is.numeric, function(x) as.integer(x < .05)) %>%
    as.data.frame() %>%
    tibble::column_to_rownames("ensembl_gene_id_version") %>%
    upset(nsets = 6,
        nintersects = 204,
        order.by = "freq")
```

## Drimseq only

```{r}
df %>%
    select_at(vars(-matches("dexseq"))) %>%
    mutate_if(is.numeric, function(x) as.integer(x < .05)) %>%
    as.data.frame() %>%
    tibble::column_to_rownames("ensembl_gene_id_version") %>%
    upset(nsets = 6,
        nintersects = 204,
        order.by = "freq")
```

# List of genes that show DTU in any of the analyses

```{r}
df_sub <- read_csv(snakemake@input[["signif"]])

df_sub %>%
    filter_if(is.numeric, any_vars(. < .05)) %>%
    knitr::kable(format = "html") %>%
    kableExtra::kable_styling() %>%
    kableExtra::scroll_box(width = "100%", height = "600px")
```
