---
title: "Comparison of DGE, DTE and DTU, only genes/transcripts detected by all methods"
author: "Christoph Kiefer"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    html_document:
        toc: true
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE)
```

```{r}
save.image("dtu.RData")
```

```{r library, include=FALSE}
source("packrat/init.R")
library("dplyr")
library("readr")
library("purrr")
library("ggplot2")
library("ggthemes")
library("DESeq2")
library("cowplot")
library("UpSetR")
library("topGO")
    select <- dplyr::select
    rename <- dplyr::rename
    BPPARAM = BiocParallel::MulticoreParam(snakemake@threads[[1]])
```

```{r dataImport}
# biomart
biomart_gene <- read_rds(snakemake@input[["biomaRt_gene"]])

biotype_groups <- read_csv(snakemake@input[["grouped_biotypes"]]) %>% 
    rename(gene_biotype = transcript_biotype)

# chip
chip <- read_csv(snakemake@input[["chip"]])

# dexseq 
dexseq <- c(snakemake@input[["illumina_dex"]], snakemake@input[["teloprime_dex"]]) %>% 
    set_names(., tools::file_path_sans_ext(basename(.), compression = TRUE)) %>% 
    as.list() %>% 
    map(read_csv) %>% 
    map(select, ensembl_gene_id_version, padj)

# drimseq
drimseq_teloprime <- read_tsv(snakemake@input[["teloprime_drim"]]) %>% 
    rename(mgi_symbol = "GeneSymbol",
        ensembl_gene_id_version = "geneID",
        ensembl_transcript_id_version = "txID")

drimseq <- snakemake@input[["illumina_drim"]] %>% 
    set_names(., tools::file_path_sans_ext(basename(.), compression = TRUE)) %>% 
    as.list() %>% 
    map(read_csv)

drimseq[[2]] <- drimseq_teloprime
names(drimseq)[2] <- tools::file_path_sans_ext(basename(snakemake@input[["illumina_drim"]]),
                                               compression = TRUE)

drimseq <- drimseq %>%
    map(select, ensembl_gene_id_version, padj = "gene") %>% 
    map(group_by, ensembl_gene_id_version) %>% 
    map(summarise, padj = min(padj))
```
